1. MODELO DE FUNCIONAMENTO (VIS√ÉO GERAL)
Pap√©is

Cliente

Criar / editar documentos

Usar editor conforme plano

Exportar PDF se permitido

Admin

Acesso total

Criar templates

Definir normas ABNT

Gerenciar usu√°rios, planos e permiss√µes

Fluxo do Documento

Usu√°rio clica Novo Documento

Escolhe:

Template

T√≠tulo

Abre editor TinyMCE

Salva conte√∫do (HTML)

Exporta:

PDF (template + ABNT)

Futuro: MP3 (narrador)

2. EDITOR ‚Äì TinyMCE (CORE DO SISTEMA)

Voc√™ acertou em cheio escolhendo TinyMCE.

Funcionalidades que vamos ativar

Fonte (fam√≠lia e tamanho)

Negrito / It√°lico / Sublinhado

Cores

Alinhamento

Listas (marcadores e numera√ß√£o)

Tabelas

Upload de imagens

Inser√ß√£o de HTML (controlado)

Templates (dropdown)

Estilos customizados (ABNT)

Configura√ß√£o base (resumo)
tinymce.init({
  selector: '#editor',
  plugins: [
    'lists', 'link', 'image', 'table', 'code',
    'preview', 'fullscreen', 'wordcount', 'template'
  ],
  toolbar: `
    undo redo | fontfamily fontsize |
    bold italic underline | forecolor backcolor |
    alignleft aligncenter alignright justify |
    bullist numlist | table image |
    template | fullscreen preview
  `,
  font_family_formats: `
    Arial=arial,helvetica,sans-serif;
    Times New Roman=times new roman,times;
    Calibri=calibri;
  `,
});

3. TEMPLATES (SEU DIFERENCIAL)

Sua tabela templates est√° excelente. Ela j√° suporta:

Controla automaticamente:

Tamanho do papel

Margens

Fonte e tamanho

Alinhamento

Entrelinhas

Cabe√ßalho / Rodap√©

Numera√ß√£o de p√°ginas

Capa

Como aplicar o template

Ao abrir o editor:

Busca template no banco

Injeta CSS no TinyMCE

Aplica como estilo padr√£o

Exemplo de CSS gerado dinamicamente:

body {
  font-family: "Times New Roman";
  font-size: 12pt;
  line-height: 1.5;
  text-align: justify;
  margin: 3cm 2cm 2cm 3cm;
}

4. DOCUMENTS (SALVAMENTO E USO)

Sua tabela documents est√° correta e bem pensada.

Campos-chave

conteudo_html ‚Üí HTML do TinyMCE

prefacio ‚Üí texto separado

template_id ‚Üí define visual final

gerar_indice ‚Üí ativa sum√°rio autom√°tico

capa_personalizada ‚Üí JSON (imagem + textos)

Salvamento

Endpoint:

POST /document/save


Salva:

HTML puro

Template selecionado

Atualiza document_usage

5. EXPORTA√á√ÉO PDF (ABNT)
Ferramenta recomendada

Dompdf ou mPDF
(mPDF √© melhor para ABNT e rodap√©/cabe√ßalho)

Processo

Carrega documento

Carrega template

Monta HTML final:

Capa

Pref√°cio

Conte√∫do

√çndice (se ativado)

Aplica CSS ABNT

Gera PDF

√çndice autom√°tico

TinyMCE j√° gera <h1>, <h2>, <h3>
O mPDF consegue gerar sum√°rio automaticamente com base nisso.

6. FUNCIONALIDADES AVAN√áADAS (ROADMAP REALISTA)
‚úÖ Curto prazo (vi√°vel agora)

Editor completo

Templates

Exporta√ß√£o PDF

Capa autom√°tica

Limite por plano

Controle RBAC

‚ö†Ô∏è M√©dio prazo

Corretor ortogr√°fico
(TinyMCE Premium ou integra√ß√£o LanguageTool)

√çndice autom√°tico avan√ßado

üî• Futuro (alto valor)

Exportar MP3

Amazon Polly

Google TTS

Convers√£o para livro

Cap√≠tulos autom√°ticos

Normas ABNT por tipo de trabalho

7. AJUSTE NA SIDEBAR (DOCUMENTOS)

Voc√™ j√° est√° quase certo. O correto √©:

<?php if (PermissionMiddleware::can('documents.edit')): ?>
    <a href="<?= BASE_URL ?>/editor"
       class="p-3 rounded-lg <?= active('/editor') ?>">
        Novo Documento
    </a>
<?php endif; ?>


E exporta√ß√£o:

<?php if (PermissionMiddleware::can('documents.export')): ?>
    <a href="<?= BASE_URL ?>/document/export/pdf/<?= $doc->id ?>">
        Exportar PDF
    </a>
<?php endif; ?>